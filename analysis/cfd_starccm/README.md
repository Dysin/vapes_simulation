# 一、问题与物理量纲（为什么要做这些模型）

目标通常包括：

* 吸阻 / 压降（口感相关的宏观量）
* 速度与湍流场（影响雾滴输运）
* 雾滴/蒸气的汽化、蒸发、凝结与沉积（口内剂量、口感与残留）
* 雾滴粒径变化、停留时间与在气道内的分布（健康 / 吸收相关）
* 口腔/喉部/吸入口处的局部温度场（影响蒸发）

这些目标决定了你需要**耦合流体（空气）＋能量＋质量传输（蒸汽/蒸发）＋颗粒相（离散滴或连续相）**的多物理场模型，且通常需要非稳态求解（吸入为时间变化过程）。

---

# 二、选择多相流模型：决策树（核心）

1. **颗粒体积分数很低（稀疏雾滴）且关注单滴轨迹、沉积、蒸发** → 推荐 **Euler-Lagrange（离散相/Discrete Phase）**：将气相用连续方程求解，雾滴用 Lagrangian parcels/particles 跟踪并做动量/能量/质量耦合（双向耦合或单向耦合，视浓度而定）。
2. **液相局部体积分数较高（显著液膜、喷嘴附近溶液 / 喷雾浓密区）** → 考虑 **VOF（Volume-of-Fluid）/Eulerian-Multiphase**：用于界面跟踪或两相连续相混合（如形成液膜、桥接流道的情形）。
3. **两类情况并存（喷雾源产生高浓度区，但总体为稀相）** → 混合策略：喷雾源附近用 Eulerian 或 VOF 解决初期耦合，远场用 Lagrangian 粒子跟踪（需要模型切换或coupling策略）。
4. **乳化/蒸气相显著、需要物种传输（PG/VG 的蒸发、蒸汽输运）** → 必须打开物种（species）传输 + 能量方程，并在 Lagrangian-gas 处设置蒸发模型（mass exchange）。

---

# 三、关键理论模型（要熟悉的方程/模型）

* 连续相：不可压或弱可压的不可压Navier-Stokes（得看速度/压差），能量方程（温度）与湍流闭合（RANS：k-ω SST 或 k-ε，或 LES/LES-wall 模型）。
* 湍流-粒子相互作用：颗粒动量、湍流扩散（随机漫步模型 RANS 下的 RANS-based stochastic tracking / LES 下的 resolved turbulence effect）。
* 粒子动力学：重力、惯性、阻力、热质交换、蒸发/凝结、碰撞/聚合（若重要）。
* 喷雾模型：初始粒径分布（Rosin-Rammler / log-normal）、喷嘴速度/方向分布、primary/secondary breakup（TAB、KH-RT 等模型可选）。
* 蒸发模型：基于传热/质量传输 (dmdt = f(Re, Sc, Sh) 或经典的 d^2-law 变形)，包含饱和蒸汽压（与液相混合组分有关）。
* 界面追踪（VOF）：体积分数方程 + 曲率/表面张力模型（CSF）以获取液膜形态。
* 湍流模型选择：若关注时间瞬态结构（喷雾脉冲、涡街），建议 LES；若目标为平均压降与宏观分布，RANS（SST）通常足够且便于收敛。

---

# 四、详细工程流程（步骤化，STAR-CCM+ 可直接映射）

## 1）问题定义 & 物理假设

* 明确仿真目标（压降、沉积率、入口雾滴参数等）。
* 是否考虑热传导到固体（发热丝、机壳）？若是，需耦合固体热传导。
* 工况：吸入工况（瞬态吸力曲线）或稳态近似？一般建议**瞬态**，采样呼吸曲线（流量 vs 时间）。
* 雾化源设定：喷雾持续/脉冲、滴径分布、初始速度、温度、液相组分（PG/VG 比）。

## 2）几何建模（CAD）

* 保留关键细节：雾化区（雾化芯/丝圈/喷嘴）、雾化器腔室、气道、咬嘴/口腔段。
* 尽量简化不影响流场的微小倒角（简化小特征减少网格量）。
* 为后处理方便，给重要表面命名（inlet、outlet、atomizer_surface、wall_mouthpiece 等）。

## 3）网格（mesh）策略

* 使用 **多尺度网格**：雾化区与嘴端细化，远场可粗。
* 建议：**polyhedral / general poly mesh + prism layers**（壁面边界层至少 3–8 层，根据 y+ 要求）。
* 局部最小单元尺寸：雾化区保证能解析喷雾喷出速度梯度，建议从 **≈ 5–100 μm**（视几何与计算资源）到 0.1 mm 级别做渐进网格敏感性。
* 若使用 VOF 或高分辨界面追踪：网格需足够细以解析液膜厚度与界面（通常更细）。
* 网格质量：检查非正交、扭曲、膨胀比，尽量保持低非正交。

## 4）物性与模型设置（STAR-CCM+ 中的物理连续体）

* 基本方程：不可压或可压（通常低速吸入，选不可压/弱可压的 pressure-based solver），打开能量方程与物种（species）传输。
* 湍流：先用 RANS k-ω SST（收敛快、对分离处理较好）；需要时切换 LES（计算量大）。
* 多相：

  * 绝大多数电子烟仿真使用 **单向或双向耦合的离散相（Lagrangian particles/parcels）** + 气相（continuous）。
  * 若要解析液膜/界面则用 **VOF** 或 **Eulerian multiphase**。
* 粒子模型设置：

  * Parcel 概念：一个 parcel 代表若干实际雾滴（可显著减少计算量）。
  * 注入（Injection）：位置、方向、速度、质量流、温度、滴径分布（Rosin-Rammler: 指定 D50 与分布指数）。
  * Breakup：如果有强剪切喷雾，开启 breakup model（如果 STAR-CCM+ 内置提供 TAB、KH-RT 可选）。
  * Evaporation：开启 droplet-vapor mass transfer。需提供液体蒸汽压、分子量、粘度、表面张力、潜热等（对 PG/VG 差异敏感）。
  * 湍流扩散：设置湍流随机漫步参数、湍流打散模型。
* 物种与相平衡：

  * 若关注蒸汽浓度，定义液相组分（PG/VG）为蒸发源，气相中传输相应物种，可能需要反应 /混合规则（通常非化学反应）。
* 墙面处理：粘附/二次喷溅/液膜形成：

  * 若关心沉积率/黏附，设置 wall interaction：stick/reflect/film formation（若 STAR-CCM+ 支持 film model，可开启并设置接触角、再蒸发）。
* 热传导与固体耦合：

  * 若丝圈温度显著影响蒸发，耦合结构导热或在边界上给定热通量/温度。

## 5）边界条件（建议）

* 入口 (inlet)：流量谱（瞬态），或速度/压力条件。若模拟吸气过程，使用 time-varying mass flow / velocity profile（以真实吸入曲线作输入）。
* 雾化注入（Injection）：位置、方向、喷雾角、瞬态强度（脉冲式雾化对应 time schedule）。
* 出口 (outlet)：静压（大气压）或开放边界；若口部连接到狭窄通道，需小心反射。
* 墙：no-slip；若热耦合，给定热流或温度。
* 初场：初始气体温度、初始物种浓度（若前一时间段残留，需给定初始场）。

## 6）数值求解控制（numerics）

* 求解器：压力基（PISO/SEGREGATED/COUPLED，若瞬态强耦合建议使用 PISO 或隐式耦合 scheme）。
* 时间步：

  * 根据 CFL、粒子解析和喷雾脉冲特征决定。示例：若流速 1 m/s、网格尺度 0.1 mm，则 dt ≈ 1e-4 s 能较好解析；但这会很贵。实务上常取 1e-4 — 1e-3 s 范围并做敏感性。
  * 粒子跟踪：确保粒子每步不会跨越过多单元（可设 max particle CFL）。
* 迭代/耦合：每个时间步内部迭代次数足够（如 10–30 iters）以收敛速度/压力场；若双向耦合（颗粒对气相显著影响），每步需进行耦合更新。
* 收敛判据：残差、监测点的物理量稳定（质量守恒误差、总压降、喷雾质量守恒）。

## 7）求解策略（稳态 vs 瞬态）

* **稳态**：只用于长期平均量或粗略压降估计，不适用于脉冲喷雾与瞬态蒸发行为。
* **瞬态**（推荐）：使用真是吸入曲线（例如 2s 吸入谱），记录瞬时与累积量。瞬态可以捕获喷雾开始/停止、涡街与泵吸效果。

## 8）后处理（要看哪些量）

* 全场速度、压力、湍流强度（观察吸阻、分离区）。
* 雾滴轨迹图、落壁分布（沉积率、沉积位置）。
* 雾滴尺寸随时间/位置分布（DSD downstream）。
* 蒸气/物种质量分数场（了解吸入剂量）。
* 温度场（气体与粒子温差）。
* 关键指标：入口-出口压降、局部最大速度、口腔内沉积率、到达喉部的颗粒总质量或数量分数、蒸发质量率（kg/s）。
* 做网格与时间步敏感性分析（至少 3 种网格/时间步）。

---

# 五、常见具体参数建议（工程经验值，视资源调整）

> 注：以下为典型工程建议，具体数值应做敏感性试验。

* **初始粒径分布**：D50 1–10 μm 常见（很多电子烟雾滴在这个范围）。Rosin-Rammler shape parameter 1.5–3。
* **粒子数量**：使用 parcel 代表实际雾滴，可从 1e4–1e6 个 parcel（视预算）。确保每个 parcel 所代表的质量在统计上足够精确。
* **时间步**：1e-4 — 1e-3 s 起步；若 LES，dt 需更小。
* **网格**：雾化区局部 cell size << 喷雾半径（0.01–0.1 mm），嘴部/喉部 0.05–0.5 mm。
* **湍流模型**：k-ω SST 作为默认（收敛稳健）；对瞬态细节用 LES。
* **湍流-粒子耦合**：若局部质量加载 < 1%（体积分数），单向耦合或双向弱耦合可能够用；若更高，必须双向或完全耦合。

---

# 六、验证与不确定性（必做）

1. **网格无量纲化检查**：网格独立性测试（至少 2–3 个网格等级）。
2. **时间步收敛**：缩短 dt 验证关键指标（压降、沉积率）是否变化。
3. **喷雾模型敏感性**：D50、分布形状、注入角/速度变化对结果的影响。
4. **物性敏感性**：液体的蒸汽压与成分比例（PG/VG）对蒸发有显著影响。
5. **对比实验数据**：若有实验（压降测量、落壁质量、下游粒径谱）应做对比与校准。
6. **质量守恒检查**：输入液相质量 = 沉积 + 蒸发到气相（numerical loss 应极小）。

---

# 七、STAR-CCM+ 的实操提示（映射到 GUI / macro）

* 在 STAR-CCM+ 创建多个 continua：Air (single phase continuous)，Particles (Lagrangian parcels)，若需要 VOF 则创建 multiphase continuum。
* 使用 **“Discrete Phase Model” / “Lagrangian Particle Tracking”**（STAR 中叫 particle tracking / parcels），设置 injection type、distribution（Rosin-Rammler）。
* 开启 **Energy equation** 与 **Species transport**（定义 PG/VG 为 species，并给出 vapor pressure/蒸发参数）。
* 打开 **turbulence**（RANS k-ω SST）并配置 near-wall treatment（y+ 目标）。
* 若需要 film model（壁面液体薄膜），在 STAR 中寻找 Wall Film / Film Model（若版本支持）。
* 使用 **Field Functions** 保存诸如 local droplet mass fraction、evaporation rate、deposition rate 等方便可视化的派生场。
* 批处理/自动化：把关键步骤写成 Java macro（STAR 的 macro 语言是 Java 或 Python wrapper），便于多工况参数扫描（D50、注入量、吸入曲线）。

---

# 八、常见坑与改善建议

* **粒子数太少导致统计噪声**：使用 parcel 并做统计重复，或增加采样粒子数。
* **时间步太大导致粒子“穿网格”**：设置粒子 CFL 或 max travel per step。
* **蒸发参数不准**：PG/VG 系物性对蒸发影响大，若没有精确数据，做敏感性或用实验数据校准。
* **界面模型（VOF）计算量爆炸**：仅在必需的区域使用 VOF（局部域细化），或采用局部嵌套/子网格策略。
* **双向耦合收敛困难**：先用单向耦合做初始场，再开双向耦合；逐步增加颗粒质量加载。
* **壁面 film 模型缺失或不准确**：如果 STAR 版本没有成熟的 film 模型，可在后处理估计沉积质量并用经验模型近似膜厚与再蒸发。

---

# 九、示例仿真流程（一页式操作清单）

1. CAD 导入，划分命名边界 → 保存基准几何。
2. 划分网格：polyhedral + prism layers；区域细化 near atomizer & mouthpiece。
3. 定义物理模型：不可压流 + energy + species + turbulence (k-ω SST) + Lagrangian particles；（若需要 VOF，建立对应 continuum）。
4. 指定物性：空气、PG/VG（或等效 e-liquid）、液体蒸发参数、表面张力、黏度。
5. 注入设置：parcel 注入处位置/角度；D50、distribution、mass flow、temperature；注入时间谱（与吸入同步）。
6. 边界条件：瞬态入口流量曲线；出口 pressure = 0（大气）；墙 no-slip。
7. 数值设置：PISO/segregated/implicit，dt = 1e-4—1e-3 s，内迭代 10-20 次。
8. 运行：先短时试运行（几十至几百 ms）检错，再完整吸入周期。
9. 后处理：轨迹、沉积、蒸发质量、压降曲线、DSD downstream。
10. 敏感性：网格/time/粒子/蒸发模型四项至少两组对比。

---

# 十、进阶建议（若你想推进研究或产品级）

* 用 LES 捕捉喷雾入口的瞬态涡旋结构，配合 Lagrangian 粒子提高粒子湍流传输物理精度。
* 建立实验台（压降与沉积采样）为仿真提供校准数据。
* 若关注人体吸收，需耦合药代/肺部吸收模型或借助更大尺度的呼吸道模型。
* 生成参数化研究（D50、VG/PG 比、吸入曲线）并用 DOE/响应面做优化（目标如最大到达喉部质量最小化等）。
